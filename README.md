# Investment App

Веб-приложение для оптимизации распределения инвестиций между предприятиями. Загружаете Excel с данными о доходах — получаете оптимальный план и отчёт с красивым интерфейсом.

## Возможности

- **Загрузка Excel** — таблица: первый столбец — уровни инвестиций, остальные — прибыль по предприятиям при каждом уровне.
- **Оптимизация** — алгоритм динамического программирования находит распределение инвестиций с максимальной суммарной прибылью.
- **Отчёт** — формируется Excel с распределением по предприятиям, прибылью, ROI и сводной статистикой.
- **История** — результаты сохраняются в БД, отчёты можно скачивать по ссылке.

## Стек

- **Backend:** FastAPI, SQLAlchemy (async), asyncpg
- **БД:** PostgreSQL
- **Данные:** pandas, openpyxl, numpy
- **Шаблоны:** Jinja2

## Требования

- Python 3.10+
- PostgreSQL (локально или в Docker)

## Установка и запуск

### 1. Клонирование и виртуальное окружение

```bash
git clone <repo-url>
cd InvestmentApp
python -m venv venv
```

Активация окружения:

- **Windows:** `venv\Scripts\activate`
- **Linux/macOS:** `source venv/bin/activate`

### 2. Зависимости

```bash
pip install -r requirements.txt
```

### 3. База данных

Создайте базу и пользователя в PostgreSQL. По умолчанию ожидаются:
| БД        | `file_converter_db` |
| Пользователь | `postgres`      |
| Пароль    | `postgres`          |
| Хост      | `localhost`         |

Строка подключения задаётся в `app/database.py`. Для своих учётных данных можно использовать переменные окружения (см. ниже).

### 4. Переменные окружения (опционально)

В корне проекта можно создать файл `.env` и задать:

```env
DATABASE_URL=postgresql+asyncpg://user:password@host/dbname
```

Если в коде используется `python-dotenv` и чтение `os.getenv("DATABASE_URL")`, подключение будет браться из окружения.

### 5. Запуск

```bash
uvicorn app.main:app --reload --port 8003
```

Откройте в браузере: **http://localhost:8003**

## Использование

1. На главной странице нажмите «Выберите файл» и укажите Excel-файл в нужном формате.
2. После загрузки откроется страница с результатами: максимальная прибыль, распределение по предприятиям, статистика.
3. Скачайте отчёт кнопкой «Скачать отчёт» — получите Excel с детализацией и листом «Итоги».

**Формат входного Excel:** без заголовков; первая колонка — суммы инвестиций (млн), следующие колонки — прибыль каждого предприятия при соответствующем уровне инвестиций. Пример структуры: `example.xlsx`.
